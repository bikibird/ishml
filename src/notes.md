# plot

The plot plotpoint is a container for all the subplots making up the story


## Actions

plot.action

The action plotpoint contains the subplot for all possible actions.

Actions are responses to player commands. 

Each action is named by using the gerund form of the verb in the players command:

	plot.action.dropping



The action prepares an episode, which is the response to the player's command.

The action's revise method is called with the episode as the argument.  Revise unfolds each plotpoint in action's subplot and either returns the original episode. Or the most salient episode generated by one of the plotpoints of the subplot

	The subplot of each action contains "check" and "instead"

	Commands are atomic.  If a command contains mutiple subjects and objects and the action cannot be applied to all of them, the command should fail the checks. For example "drop keys and beach ball in vase" fails because the beach ball does not fit in the vase.  Therefore, dropping the keys in the vase is also not successful.

	If the check subplot returns an episode the action's episode is abridged to that episode and the "instead" subplot is skipped.  

	If the check subplot does not return an episode, but the "instead" episode does, the action's episode is revised to the instead episode.

	Otherwise, the action's episode is used.

	Revised and abridged episodes have access to the action's episode as their stock episode.


### Adding actions

Add action to plot. See  outline.js, plot.js
* plot.action.gerund.unfold=function(command){return episode}
* plot.action.gerund.check
* plot.action.gerund.instead

Add skill to actors that can perform the action in the world plotpoint (see cloakofdarknes.js)
* $.action.tie("action").to("gerund")
* $.actor.player.tie("has skill").to($.action.gerund)

Add verb to lexicon. 

lexicon.register("1st person singular verb form", "alias","another alias", "etc").as({ plot: plot.action.gerund, part: "verb", valence:1 })

The player is permitted to drop.

The ball can be dropped.  Carried or wearing tie may be untied

The room can receive a dropped ball.  containing may be tied
# net
ishml.yarn.net

Directed weighted graph.  A.K.A network.  

The net stores the story world and is a directed weighted graph also know as a network.  The nodes (vertices) are called knots and the lines connecting them are called plies. 



# Cords
/*$.thing.cup.tie("cord:ply").to(otherKnot/otherPly) --one-way relation converse===null
$.thing.cup.tie("cord:ply=otherCord:otherPly").to(otherKnot/otherPly) --converse relation converse === another ply
$.thing.cup.tie("cord:ply-otherCord:otherPly").to(otherKnot/otherPly) --mutual relation converse === another ply, but when ply properties updated, other ply is updated automatically because both share the same properties object.
$.thing.cup.tie("cord:ply@otherCord:otherPly").to(otherKnot/otherPly) --reflexive relation converse=== this ply.*/

## Filtered Cords

$.actor.player.in("cloakroom")
$.actor.player.in($.place)
$.actor.player.in($.thing.is.container)
$.place.foyer.exit("cloakroom")
$.place.foyer.exit("west")



## Computed Cords


ishml.Knot.prototype.defineCord("example").as(function)

defines new method on Knot example=new Ishml.Cord().  sets custom getter in handler 


## Adding Cords the Lexicon

By convention, the select property of the definition is a function that returns a cord.  Since ishml.Cord is sub-classed from Function, a cord is also a function. Plies have a cord property which returns a cord containing ply.  Knots also have a cord property which contains a ply pointing to the knot.  

//select($.actor.player) returns a cord containing the north ply of the room the player is in.  Parameter is the cord, knot, or ply that is a place.
.register("north","n").as({part: "noun",  select:subject=>subject.in.exit.north.cord)

//select() returns a cord containg a ply that points to the cloak knot.
.register("cloak").as({part: "noun",  select:$.thing.cloak.cord)

